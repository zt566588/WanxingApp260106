<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜ç™»å½•æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .info {
            color: blue;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª ç®¡ç†å‘˜ç™»å½•æµç¨‹æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>æµ‹è¯•1: æ­£ç¡®å‡­æ®ç™»å½•</h3>
            <p>æµ‹è¯•ç”¨æˆ·å: <strong>admin</strong></p>
            <p>æµ‹è¯•å¯†ç : <strong>admin123</strong></p>
            <button onclick="testValidLogin()">æµ‹è¯•æ­£ç¡®ç™»å½•</button>
            <div id="valid-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>æµ‹è¯•2: é”™è¯¯å‡­æ®ç™»å½•</h3>
            <p>æµ‹è¯•ç”¨æˆ·å: <strong>wronguser</strong></p>
            <p>æµ‹è¯•å¯†ç : <strong>wrongpass</strong></p>
            <button onclick="testInvalidLogin()">æµ‹è¯•é”™è¯¯ç™»å½•</button>
            <div id="invalid-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>æµ‹è¯•3: ç©ºå‡­æ®ç™»å½•</h3>
            <button onclick="testEmptyLogin()">æµ‹è¯•ç©ºå‡­æ®</button>
            <div id="empty-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>æµ‹è¯•4: è·å–é“¾æ¥åˆ—è¡¨ï¼ˆéœ€è¦è®¤è¯ï¼‰</h3>
            <button onclick="testGetLinks()">æµ‹è¯•è·å–é“¾æ¥</button>
            <div id="links-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>æµ‹è¯•5: æ·»åŠ é“¾æ¥ï¼ˆéœ€è¦è®¤è¯ï¼‰</h3>
            <button onclick="testAddLink()">æµ‹è¯•æ·»åŠ é“¾æ¥</button>
            <div id="add-result" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        let authToken = null;

        async function testValidLogin() {
            const resultDiv = document.getElementById('valid-result');
            resultDiv.innerHTML = 'æµ‹è¯•ä¸­...';
            
            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'admin', password: 'admin123' })
                });
                
                const data = await response.json();
                
                if (response.ok && data.token) {
                    authToken = data.token;
                    resultDiv.innerHTML = `<span class="success">âœ… ç™»å½•æˆåŠŸï¼</span>\nToken: ${data.token}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ ç™»å½•å¤±è´¥: ${data.error || 'æœªçŸ¥é”™è¯¯'}</span>`;
                }
            } catch (err) {
                resultDiv.innerHTML = `<span class="error">âŒ è¯·æ±‚å¤±è´¥: ${err.message}</span>`;
            }
        }

        async function testInvalidLogin() {
            const resultDiv = document.getElementById('invalid-result');
            resultDiv.innerHTML = 'æµ‹è¯•ä¸­...';
            
            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'wronguser', password: 'wrongpass' })
                });
                
                const data = await response.json();
                
                if (response.status === 401) {
                    resultDiv.innerHTML = `<span class="success">âœ… æ­£ç¡®æ‹’ç»æ— æ•ˆå‡­æ®</span>\né”™è¯¯ä¿¡æ¯: ${data.error}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ é¢„æœŸ401é”™è¯¯ï¼Œä½†å¾—åˆ°: ${response.status}</span>`;
                }
            } catch (err) {
                resultDiv.innerHTML = `<span class="error">âŒ è¯·æ±‚å¤±è´¥: ${err.message}</span>`;
            }
        }

        async function testEmptyLogin() {
            const resultDiv = document.getElementById('empty-result');
            resultDiv.innerHTML = 'æµ‹è¯•ä¸­...';
            
            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: '', password: '' })
                });
                
                const data = await response.json();
                
                if (response.status === 400) {
                    resultDiv.innerHTML = `<span class="success">âœ… æ­£ç¡®éªŒè¯ç©ºå‡­æ®</span>\né”™è¯¯ä¿¡æ¯: ${data.error}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ é¢„æœŸ400é”™è¯¯ï¼Œä½†å¾—åˆ°: ${response.status}</span>`;
                }
            } catch (err) {
                resultDiv.innerHTML = `<span class="error">âŒ è¯·æ±‚å¤±è´¥: ${err.message}</span>`;
            }
        }

        async function testGetLinks() {
            const resultDiv = document.getElementById('links-result');
            resultDiv.innerHTML = 'æµ‹è¯•ä¸­...';
            
            if (!authToken) {
                resultDiv.innerHTML = `<span class="error">âŒ è¯·å…ˆè¿›è¡Œæœ‰æ•ˆç™»å½•è·å–token</span>`;
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/links`, {
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `<span class="success">âœ… æˆåŠŸè·å–é“¾æ¥åˆ—è¡¨</span>\né“¾æ¥æ•°é‡: ${data.length}`;
                } else if (response.status === 401) {
                    resultDiv.innerHTML = `<span class="error">âŒ è®¤è¯å¤±è´¥ï¼Œtokenå¯èƒ½æ— æ•ˆ</span>`;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ è¯·æ±‚å¤±è´¥: ${response.status}</span>`;
                }
            } catch (err) {
                resultDiv.innerHTML = `<span class="error">âŒ è¯·æ±‚å¤±è´¥: ${err.message}</span>`;
            }
        }

        async function testAddLink() {
            const resultDiv = document.getElementById('add-result');
            resultDiv.innerHTML = 'æµ‹è¯•ä¸­...';
            
            if (!authToken) {
                resultDiv.innerHTML = `<span class="error">âŒ è¯·å…ˆè¿›è¡Œæœ‰æ•ˆç™»å½•è·å–token</span>`;
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/links`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        name: 'æµ‹è¯•é“¾æ¥',
                        url: 'https://example.com',
                        image: 'https://via.placeholder.com/250x150'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `<span class="success">âœ… æˆåŠŸæ·»åŠ é“¾æ¥</span>\né“¾æ¥ID: ${data.id}`;
                } else if (response.status === 401) {
                    resultDiv.innerHTML = `<span class="error">âŒ è®¤è¯å¤±è´¥ï¼Œtokenå¯èƒ½æ— æ•ˆ</span>`;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ æ·»åŠ å¤±è´¥: ${data.error || response.status}</span>`;
                }
            } catch (err) {
                resultDiv.innerHTML = `<span class="error">âŒ è¯·æ±‚å¤±è´¥: ${err.message}</span>`;
            }
        }
    </script>
</body>
</html>